{% extends 'base.html'%}
{% load static%}

{%block content%}
    <!-- ##===================================================================================## -->
                <!-- Main Listing Form -->
                
                <form action="{%url 'Listing:new-property'%}" method="post" enctype="multipart/form-data">
                    
                    {%csrf_token%}
                   
                    <div class="main-content">
                        <div class="main-content-inner">
                            <div class="button-show-hide show-mb">
                                <span class="body-1">Show Dashboard</span>
                            </div>
                            <div class="widget-box-2 mb-20">
                                <h5 class="title">Information {{payment}}</h5>
                                <div class="box-info-property">
                                    <fieldset class="box box-fieldset">
                                        <label>
                                            Title:<span>*</span>
                                        </label>
                                        {{form.title}}
                                    </fieldset>
                                    <fieldset class="box box-fieldset">
                                        <label>Description:</label>
                                        {{form.description}}
                                    </fieldset>
                                    <div class="box grid-3 gap-30">
                                        <fieldset class="box-fieldset">
                                            <label>
                                                City(Town) Name:<span>*</span>
                                            </label>
                                            {{form.city_address}}
                                        </fieldset>
                                        <fieldset class="box-fieldset">
                                            <label>
                                                Zip Code:<span>*</span>
                                            </label>
                                            {{form.zipcode}}
                                        </fieldset>
                                        <fieldset class="box-fieldset">
                                            <label>
                                                Country:<span>*</span>
                                            </label>
                                            {{form.country}}
                                        </fieldset>
                                    </div>
                                    <div class="box grid-2 gap-30">
                                        <fieldset class="box-fieldset">
                                            <label>
                                                Province/State:<span>*</span>
                                            </label>
                                            {{form.province}}
                                        </fieldset>
                                        <fieldset class="box-fieldset">
                                            <label>
                                                Ownership Documents:<span>*</span>
                                            </label>
                                            {{form.ownership_documents}}
                                        </fieldset>
                                    </div>
                                    <div class="box box-fieldset">
                                        <label>Location:<span>*</span></label>
                                        <div class="box-ip">
                                            {{form.location}}
                                        </div>

                                    </div>

                                
                                         <!--  New Button added here -->
                                 <button type="button" onclick="openMapModal()">Select Location on Map</button>
                                 <input type="hidden" id="id_latitude" name="latitude">
                                 <input type="hidden" id="id_longitude" name="longitude">
                                 
                                 <!-- Map Modal -->
                             
                                 
                                 <div id="mapModal" style="display:none; position: fixed; top: 10%; left: 10%; width: 80%; height: 80%; background: white; z-index: 1000; border: 1px solid #ccc;">
    
                                    <button onclick="closeMapModal()" style="float:right; margin: 10px;">Close</button>
    
                                    <div id="map" style="width: 100%; height: 90%;"></div>

                                </div>



                                </div>
                            </div>
                            <div class="widget-box-2 mb-20">
                                <h5 class="title">Price</h5>
                                <div class="box-price-property">
                                    <div class="box grid-2 gap-30">
                                        <fieldset class="box-fieldset">
                                            <label>Price:<span>*</span></label>
                                            {{form.price}}
                                        </fieldset>
                                        <fieldset class="box-fieldset">
                                            <label>
                                                Have Bank Dedt:<span>*</span>
                                            </label>
                                            {{form.bank_debt}}
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                            <div class="widget-box-2 mb-20">
                                <h5 class="title">Addtional Infomation</h5>
                                <div class="box grid-3 gap-30">
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Property Type:<span>*</span>
                                        </label>
                                        {{form.property_type}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Property Status:<span>*</span>
                                        </label>
                                        {{form.property_status}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Condition:<span>*</span>
                                        </label>
                                        {{form.property_condition}}
                                    </fieldset>
                                </div>
                                <div class="box grid-3 gap-30">
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Size (Sqm):<span>*</span>
                                        </label>
                                        {{form.property_size}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Land Area (Sqm):<span>*</span>
                                        </label>
                                        {{form.property_landarea}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Furnished:<span>*</span>
                                        </label>
                                        {{form.furnished}}
                                    </fieldset>
                                </div>
                                <div class="box grid-3 gap-30">
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Rooms:<span>*</span>
                                        </label>
                                        {{form.property_rooms}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label >
                                            Bedrooms:<span>*</span>
                                        </label>
                                        {{form.bedrooms}}
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Bathrooms:<span>*</span>
                                        </label>
                                        {{form.bathrooms}}
                                    </fieldset>
                                </div>
                                <div class="box grid-3 gap-30">
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Parking Space:<span>*</span>
                                        </label>
                                        {{form.parking}}
                                     </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Kitchens:<span>*</span>
                                        </label>
                                        {{form.kitchens}}
                                        <!-- <input type="text" class="form-control"> -->
                                    </fieldset>
                                    <fieldset class="box-fieldset">
                                        <label>
                                            Balcony:<span>*</span>
                                        </label>
                                        {{form.balcony}}
                                        <!-- <input type="text" class="form-control">  -->
                                    </fieldset>
                                </div>
                            </div>
                            <div class="widget-box-2 mb-20">
                                <h5 class="title">Upload Media</h5>
                                <div class="box-uploadfile text-center">
                                    <div class="uploadfile">
                                        <div class="btn-upload tf-btn primary">
                                            <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13.625 14.375V17.1875C13.625 17.705 13.205 18.125 12.6875 18.125H4.5625C4.31386 18.125 4.0754 18.0262 3.89959 17.8504C3.72377 17.6746 3.625 17.4361 3.625 17.1875V6.5625C3.625 6.045 4.045 5.625 4.5625 5.625H6.125C6.54381 5.62472 6.96192 5.65928 7.375 5.72834M13.625 14.375H16.4375C16.955 14.375 17.375 13.955 17.375 13.4375V9.375C17.375 5.65834 14.6725 2.57417 11.125 1.97834C10.7119 1.90928 10.2938 1.87472 9.875 1.875H8.3125C7.795 1.875 7.375 2.295 7.375 2.8125V5.72834M13.625 14.375H8.3125C8.06386 14.375 7.8254 14.2762 7.64959 14.1004C7.47377 13.9246 7.375 13.6861 7.375 13.4375V5.72834M17.375 11.25V9.6875C17.375 8.94158 17.0787 8.22621 16.5512 7.69876C16.0238 7.17132 15.3084 6.875 14.5625 6.875H13.3125C13.0639 6.875 12.8254 6.77623 12.6496 6.60041C12.4738 6.4246 12.375 6.18614 12.375 5.9375V4.6875C12.375 4.31816 12.3023 3.95243 12.1609 3.6112C12.0196 3.26998 11.8124 2.95993 11.5512 2.69876C11.2901 2.4376 10.98 2.23043 10.6388 2.08909C10.2976 1.94775 9.93184 1.875 9.5625 1.875H8.625" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            Select photos
                                            {{form.property_image}}
                                            <!-- <input type="file" class="ip-file"> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="box-img-upload">
                                </div>
                            </div>
                            <div class="widget-box-2 mb-20">
                                <h5 class="title">Videos</h5>
                                <fieldset class="box-fieldset">
                                    <label class="text-btn">Video URL:</label>
                                    {{form.link}}
                                </fieldset>
                            </div>

                            <div class="box-btn" style="display: flex; justify-content: center; align-items: center;">
                                <button type="submit" class="tf-btn primary">Add Property</button> </div>
                        </div>
                        <div class="footer-dashboard">
                            <p>Copyright © 2025 Home Lengo</p>
                        </div>
                    </div>
                </form>
                <!-- ##==========================================## -->
                <div class="overlay-dashboard"></div>

            </div>
        </div>
        <!-- /#page -->

    </div>
    <!-- go top -->
    <div class="progress-wrap">
        <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" style="transition: stroke-dashoffset 10ms linear 0s; stroke-dasharray: 307.919, 307.919; stroke-dashoffset: 286.138;"></path>
        </svg>
    </div>

    <!-- Include Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
var map, marker;
var mapInitialized = false;
 // Function to open the map modal

function openMapModal() {
     // Display the map modal by setting its display style to 'block'
  document.getElementById('mapModal').style.display = 'block';
// Initialize map only if it hasn't been initialized already
  if (!mapInitialized) {
    mapInitialized = true;
    // Create the map centered at Ethiopia [lat, lng] with zoom level 6

    map = L.map('map').setView([9.145, 40.489], 6);
     // Add a tile layer from CartoDB for map visuals
    
       L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
         attribution: '&copy; OpenStreetMap contributors & CartoDB',
         maxZoom: 18
       }).addTo(map);
    marker = L.marker([9.03, 38.74], { draggable: true }).addTo(map);

    // When marker is dragged, update hidden inputs
    marker.on('dragend', function(e) {
      var latlng = marker.getLatLng();
      document.getElementById('id_latitude').value = latlng.lat;
      document.getElementById('id_longitude').value = latlng.lng;
    });

    // Or if user clicks on the map, move the marker
    map.on('click', function(e) {
      marker.setLatLng(e.latlng);
      document.getElementById('id_latitude').value = e.latlng.lat;
      document.getElementById('id_longitude').value = e.latlng.lng;
    });
  }
}
// Function to close the map modal
function closeMapModal() {
  document.getElementById('mapModal').style.display = 'none';
}
</script>

{%endblock%}